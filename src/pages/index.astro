---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const featuredGuides = (await getCollection('guides'))
  .filter(guide => guide.data.featured)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const recentBlog = (await getCollection('blog'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<Layout title="Home" description="Travel guides and stories from the road. Plan your next overlanding adventure with detailed route guides, camping info, and real experiences from remote highways.">
  <!-- Hero Section -->
  <section class="max-w-6xl mx-auto px-4 py-20 text-center">
    <h1 class="text-5xl md:text-7xl font-bold mb-6 tracking-tight">
      Coffee & Kilometres
    </h1>
    <p class="text-xl md:text-2xl text-[rgb(var(--color-text-muted))] max-w-3xl mx-auto leading-relaxed">
      Detailed guides, honest stories, and practical resources for overlanders exploring remote highways and backcountry routes.
    </p>
  </section>

  <!-- Featured Guides -->
  {featuredGuides.length > 0 && (
    <section class="max-w-6xl mx-auto px-4 py-12">
      <h2 class="text-3xl font-bold mb-8">Featured Guides</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        {featuredGuides.map((guide) => (
          <a
            href={`/guides/${guide.slug}`}
            class="group block border border-[rgb(var(--color-border))] rounded-lg overflow-hidden hover:border-[rgb(var(--color-accent))] transition-colors"
          >
            {guide.data.heroImage && (
              <div class="aspect-video bg-[rgb(var(--color-border))] overflow-hidden">
                <img
                  src={guide.data.heroImage}
                  alt={guide.data.heroImageAlt || guide.data.title}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                />
              </div>
            )}
            <div class="p-6">
              <div class="flex gap-2 mb-3 flex-wrap">
                {guide.data.tags.slice(0, 3).map((tag: string) => (
                  <span class="text-xs px-2 py-1 rounded bg-[rgb(var(--color-border))] text-[rgb(var(--color-text-muted))]">
                    {tag}
                  </span>
                ))}
              </div>
              <h3 class="text-2xl font-bold mb-2 group-hover:text-[rgb(var(--color-accent))] transition-colors">
                {guide.data.title}
              </h3>
              <p class="text-[rgb(var(--color-text-muted))] mb-4">
                {guide.data.description}
              </p>
              {(guide.data.distance || guide.data.duration) && (
                <div class="flex gap-4 text-sm text-[rgb(var(--color-text-muted))]">
                  {guide.data.distance && <span>üìç {guide.data.distance}</span>}
                  {guide.data.duration && <span>‚è±Ô∏è {guide.data.duration}</span>}
                </div>
              )}
            </div>
          </a>
        ))}
      </div>
      <div class="text-center mt-8">
        <a
          href="/guides"
          class="inline-block px-6 py-3 bg-[rgb(var(--color-accent))] text-white rounded-lg hover:bg-[rgb(var(--color-accent-hover))] transition-colors"
        >
          View All Guides
        </a>
      </div>
    </section>
  )}

  <!-- Recent Blog Posts -->
  {recentBlog.length > 0 && (
    <section class="max-w-6xl mx-auto px-4 py-12">
      <h2 class="text-3xl font-bold mb-8">From the Road</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {recentBlog.map((post) => (
          <a
            href={`/blog/${post.slug}`}
            class="group block border border-[rgb(var(--color-border))] rounded-lg overflow-hidden hover:border-[rgb(var(--color-accent))] transition-colors"
          >
            {post.data.heroImage && (
              <div class="aspect-video bg-[rgb(var(--color-border))] overflow-hidden">
                <img
                  src={post.data.heroImage}
                  alt={post.data.heroImageAlt || post.data.title}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                />
              </div>
            )}
            <div class="p-4">
              <h3 class="font-bold mb-2 group-hover:text-[rgb(var(--color-accent))] transition-colors">
                {post.data.title}
              </h3>
              <p class="text-sm text-[rgb(var(--color-text-muted))] mb-2">
                {post.data.description}
              </p>
              <time class="text-xs text-[rgb(var(--color-text-muted))]">
                {post.data.pubDate.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </time>
            </div>
          </a>
        ))}
      </div>
      <div class="text-center mt-8">
        <a
          href="/blog"
          class="inline-block px-6 py-3 border border-[rgb(var(--color-border))] rounded-lg hover:border-[rgb(var(--color-accent))] hover:text-[rgb(var(--color-accent))] transition-colors"
        >
          Read More Stories
        </a>
      </div>
    </section>
  )}
</Layout>
